---
- name: Run AWS CLI
  hosts: server01
  gather_facts: yes
  become: yes
  vars:
    user_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34626364383434323365623661653932316666643365303834656161363334613064373562336338
      3964396330303532636438383032666634383535303861350a616363623561633636616631343435
      65383835333865303061633036386338663037633164646636383633623266326165663437376632
      3562666139363530340a613337353833306333363664303664373461616134303562376438613035
      36613031656363306530323330333139353434383339643462323432316463353665323639373962
      32636339633735656535376131396338323061616532646637353939653361333039643536346334
      61646261643334376236326537366463363362613239383165616333333062613531656434343036
      32396166613964323331333832306563323232646334303130343338363061353934653037343362
      36633964366239353835333464616639613530303939643630336130643965323862666331646666
      30663731626165383365326333313161303436303230353262643531323038613362363462333732
      333233393033373730626137336162666333

  tasks:
    - name: Perform Apt update and Install basic packages
      shell: apt update && apt install -y unzip jq net-tools

    - name: install AWS CLI
      shell: |
        curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
        unzip awscliv2.zip
        sudo ./aws/install

    - name: Copy Encrypted files to .aws
      copy:
        src: /tmp/aws_creds
        dest: /root/.aws/credentials
        owner: root
        group: root
        node: "0600"
    - name: Check s3 bucket
      shell: aws s3 ls
