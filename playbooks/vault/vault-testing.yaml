---
- name: Run AWS CLI
  hosts: server01
  gather_facts: yes
  become: yes
  vars:
    user_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
       65336663303830653230386562386634643232646162356432653964663038323066626234306462
       6366613734626230393964313435653763336165343130650a343462323231623838383430643264
       35326463653062346236616333393763613163623665393935313661633731653034393337633934
       6662353536626134650a326662306361663332646236366236663933336631393365383561343739
       34646131623731326661336139623035373933356331383666623264646565383666646438356433
       34316133313931656666393164366136353137356338353738386439633662643932333562323161
       34353130383336346134303463313233353561343764343161303838386339353735666630353737
       63336230373763663634303461653661643361653230303134386636306338336537656433346432
       34313162383130626535303836366634663438336364666566643037376231303233346630626462
       66623964303439336232343562313239376330383732356530383963336264643336353636656566
       613633643661336132616165303666333731

  tasks:
    - name: Perform Apt update and Install basic packages
      shell: apt update && apt install -y unzip jq net-tools

    - name: install AWS CLI
      shell: |
        curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
        unzip awscliv2.zip
        sudo ./aws/install

    - name: Copy Encrypted files to .aws
      copy:
        src: /tmp/aws_creds
        dest: /root/.aws/credentials
        owner: root
        group: root
        node: "0600"
    - name: Check s3 bucket
      shell: aws s3 ls
